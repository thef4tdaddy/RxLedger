#!/usr/bin/env bash

GREEN="\033[0;32m"
YELLOW="\033[1;33m"
NC="\033[0m"

echo -e "${YELLOW}✨ Running Prettier formatting...${NC}"
npx prettier --write "src/**/*.{js,jsx,ts,tsx,json,css,md}"

echo -e "${YELLOW}🔧 Running ESLint autofix...${NC}"
npx eslint src --fix

echo -e "${YELLOW}📄 Showing Git status...${NC}"
git status

echo -e "${YELLOW}✅ Staging all changes...${NC}"
git add .

if git diff --cached --quiet; then
  # No changes staged
  echo -e "${YELLOW}No changes to commit.${NC}"
else
  # Changes are staged
  # Check if changes are only from formatting/linting or if there are other unstaged changes
  if git diff --quiet; then
    # No unstaged changes, so changes are only from formatting/linting
    git commit -m "chore: format and lint fixes"
  else
    # There are unstaged changes, prompt for commit message
    echo -e "${YELLOW}✏️ Enter commit message:${NC}"
    read message
    git commit -m "$message"
  fi

  echo -e "${YELLOW}🚀 Pushing to origin...${NC}"
  git push

  echo -e "${GREEN}✅ Branch cleaned up, committed, and pushed!${NC}"
fi